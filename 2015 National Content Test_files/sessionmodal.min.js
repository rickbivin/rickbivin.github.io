function SessionModal(b){var a=this;"object"!=typeof b&&(b={});a.expiresIn=parseInt(b.expiresIn)||15;a.warningLength=parseInt(b.warningLength)||5;a.warningLength*=60;a.showDelay=parseInt(b.showDelay)||500;a.hideDelay=parseInt(b.hideDelay)||500;a.origin=location.protocol+"//"+location.hostname+(location.port?":"+location.port:"");a.logoutURL=b.logoutURL||location.pathname.split("/",2)[1]+"/logout";a.renewURL=b.renewURL||location.pathname.split("/",2)[1]+"/ajax_renew_session";var c=new MyModal;c.content= b.content||'<div id="dialogdescription">Your session is about to expire. Press Ok to keep working or you will be logged out.</div>';c.content+='<div id="dialog-button-cont"><button id="dialog-renew">Ok</button></div>';c.content+='<div id="dialog-cd">Time Remaining:&nbsp;<span id="dialog-cd-time"></span></div>';c.header=b.header||'<h2 id="dialogheader">Session Expiration Warning</h2>';a.title=document.title;a._tswitch=!0;a.started=new Date;a.expires=new Date;a.expires.setMinutes(a.expires.getMinutes()+ a.expiresIn);a.warning=new Date(a.expires.getTime());a.warning.setMinutes(a.expires.getMinutes()-a.warningLength);a.tick=function(){if(a.expiresCountDown<=a.warningLength){var b=Math.floor(a.expiresCountDown%60),c=Math.floor(a.expiresCountDown/60);a._tswitch?(document.title=a.title,a._tswitch=!1):(document.title="Warning: Session about to expire.",a._tswitch=!0);$("#dialog-cd-time").text(a._lz(c)+":"+a._lz(b));0>=a.expiresCountDown&&(clearInterval(a._CDI),window.location=a.origin+"/"+a.logoutURL+"?session_timedout=1"); a.expiresCountDown--}else a.expiresCountDown--,a.expiresCountDown<=a.warningLength&&a.show(function(){$("#dialog-renew").focus()})};a.show=function(){c.show(function(){$("#dialog-renew").click(function(){a.renew_session()})})};a.hide=function(){c.hide()};a._lz=function(a){return 10>a?"0"+a:a};a.renew_session=function(){$.ajax({url:a.origin+"/"+a.renewURL,type:"GET",success:function(){a.hide();a.reset()},error:function(){$("#dialog-error").remove();$("#dialog").append('<div id="dialog-error">There was a problem renewing your session.</div>')}})}; a.reset=function(){clearInterval(a._CDI);document.title=a.title;a._tswitch=!0;a.expiresCountDown=(a.expires.getTime()-a.started.getTime())/1E3;a._CDI=setInterval(a.tick,1E3)};a.expiresCountDown=(a.expires.getTime()-a.started.getTime())/1E3;a._CDI=setInterval(a.tick,1E3)};
